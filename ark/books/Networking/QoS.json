[{"pageNumber":1,"pageContent":"packetlife.net by Jeremy Stretch v2.0 Q UALITY OF S ERVICE · P ART 1 Quality of Service Models Layer 2 QoS Markings Medium Ethernet Class of Service (CoS) Name Type 3-bit 802.1p field in 802.1Q header Frame Relay Discard Eligibility (DE) 1-bit drop eligibility flag Best Effort · No QoS policies are implemented Integrated Services (IntServ) Resource Reservation Protocol (RSVP) is used to res erve bandwidth per- flow across all nodes in a path Differentiated Services (DiffServ) Packets are individually classified and marked; pol icy decisions are made independently by each node in a path IP Type of Service (TOS) Ver HL Len TOS Precedence DSCP Precedence/DSCP Binary 111 000 Reserved DSCP 56 Prec. 7 110 000 Reserved 48 6 101 110 EF 46 5 100 00 0 32 4 100 01 0 34 100 10 0 36 100 11 0 38 011 00 0 24 3 011 01 0 26 011 10 0 28 011 11 0 30 010 00 0 16 2 010 01 0 18 010 10 0 20 010 11 0 22 001 00 0 8 1 001 01 0 10 001 10 0 12 001 11 0 14 000 000 BE 0 0 CS 4 AF 4 1 AF 4 2 AF 4 3 CS 3 AF 3 1 AF 3 2 AF 3 3 CS 2 AF 2 1 AF 2 2 AF 2 3 CS 1 AF 1 1 AF 1 2 AF 1 3 ATM MPLS Cell Loss Priority (CLP) Traffic Class (TC) 1-bit drop eligibility flag 3-bit field compatible with 802.1p IP QoS Markings IP Precedence The first three bits of the IP TOS field; limited t o 8 traffic classes Differentiated Services Code Point (DSCP) The first six bits of the IP TOS are evaluated to p rovide more granular classification; backward-compatible with IP Precede nce QoS Flowchart Hardware Queue Queuing Decision Scheduler Software Queue No Yes Software Queue Software Queue HW Queue Full? Terminology Per-Hop Behavior (PHB) The individual QoS action performed at each indepen dent DiffServ node Trust Boundary · Beyond this, inbound QoS markings are not trusted Tail Drop · Occurs when a packet is dropped because a queue i s full Policing Imposes an artificial ceiling on the amount of band width that may be consumed; traffic exceeding the policer rate is rec lassified or dropped Shaping Similar to policing but buffers excess traffic for delayed transmission; makes more efficient use of bandwidth but introduce s a delay DSCP Per-Hop Behaviors Class Selector (CS) · Backward-compatible with IP Precedence values Assured Forwarding (AF) · Four classes with variable drop preferences Expedited Forwarding (EF) · Priority queuing for delay-sensitive traffic Congestion Avoidance Random Early Detection (RED) Packets are randomly dropped before a queue is full to prevent tail drop; mitigates TCP synchronization Weighted RED (WRED) RED with the added capability of recognizing prioritized traffic based on its marking TCP Synchronization Flows adjust TCP window sizes in synch, making inef ficient use of a link Class-Based WRED (CBWRED) WRED employed inside a class- based WFQ (CBWFQ) queue"},{"pageNumber":2,"pageContent":"packetlife.net by Jeremy Stretch v2.0 Q UALITY OF S ERVICE · P ART 2 Queuing Comparison Default on Interfaces >2 Mbps FIFO Number of Queues 1 Configurable Classes Bandwidth Allocation Provides for Minimal Delay Modern Implementation No Automatic No Yes No PQ 4 Yes Automatic Yes No No CQ Configured Yes Configured No No <=2 Mbps WFQ Dynamic No Automatic No No No CBWFQ Configured Yes Configured No Yes No LLQ Configured Yes Configured Yes Yes First In First Out (FIFO) Priority Queuing (PQ) LLQ Config Example ! Match packets by DSCP value class-map match-all Voice match dscp ef ! class-map match-all Call-Signaling match dscp cs3 ! class-map match-any Critical-Apps match dscp af21 af22 ! ! Match packets by access list class-map match-all Scavenger match access-group name Other Class Definitions policy-map Foo class Voice ! Priority queue policed to 33% priority percent 33 class Call-Signaling ! Allocate 5% of bandwidth bandwidth percent 5 class Critical-Apps bandwidth percent 20 ! Extend queue size to 96 packets queue-limit 96 class Scavenger ! Police to 64 kbps police cir 64000 conform-action transmit exceed-action drop class class-default ! Enable WFQ fair-queue ! Enable WRED random-detect Policy Creation interface Serial0 ! Apply the policy in or out service-policy output Foo Policy Application LLQ Config Example show policy-map [interface] Show interface show queue <interface> High Medium Normal Low Hardware Queue Hardware Queue Tx Ring Custom Queuing (CQ) Weighted Fair Queuing (WFQ) · Packets are transmitted in the order they are processed · No prioritization is provided · Default queuing method on high- speed (>2 Mbps) interfaces · Configurable with the tx-ring- limit interface config command · Provides four static queues which cannot be reconfigured · Higher-priority queues are always emptied before lower- priority queues · Lower-priority queues are at risk of bandwidth starvation · Rotates through queues using Weighted Round Robin (WRR) · Processes a configurable number of bytes from each queue per turn · Prevents queue starvation but does not provide for delay- sensitive traffic · Queues are dynamically created per flow to ensure fair processing · Statistically drops packets from aggressive flows more often · No support for delay-sensitive traffic Class-Based WFQ (CBWFQ) Low Latency Queuing (LLQ) · WFQ with administratively configured queues · Each queue is allocated an amount/percentage of bandwidth · No support for delay-sensitive traffic · CBWFQ with the addition of a policed strict-priority queue · Highly configurable while still supporting delay-sensitive traffic Flow 1 Flow 2 Flow n ... Hardware Queue 500 B/cycle 4500 B/cycle 1500 B/cycle Queue A Queue B Queue C Hardware Queue 512 Kbps Min 1024 Kbps Min Remainder Queue A Queue B Default Hardware Queue 512 Kbps Min 1024 Kbps Min Remainder Queue A Queue B Default 512 Kbps Max Priority Hardware Queue Show mls qos"}]
